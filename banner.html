<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Banners</title>
  <script src="productos.js"></script>
  <script src="precios.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      text-align: center;
      margin: 20px;
      background: none;
    }
    .tabs {
      margin: 20px 0;
    }
    .tab-btn {
      padding: 10px 20px;
      margin: 0 5px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #00254a;
      color: white;
      font-weight: bold;
      transition: background 0.3s;
    }
    .tab-btn.active {
      background: #ff6200;
    }
    .preview {
      position: relative;
      width: 1200px;
      height: 500px;
      margin: 20px auto;
      display: none;
      align-items: center;
      justify-content: space-between;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      background: linear-gradient(75deg, #ffffff 0%, #00254a 90%);
      overflow: hidden; /* ✅ evita desbordes */
    }
    .preview.active { display: flex; }
    .preview img.product {
      flex: 1;
      max-width: 45%;
      max-height: 100%; /* ✅ nunca se pasa de alto */
      object-fit: contain;
      border-radius: 12px;
      align-self: center;
    }
    .info { text-align: left; max-width: 50%; }
    .info h2 {
      font-size: clamp(2rem, 1.5vw, 2rem); /* mínimo 1rem, ideal proporcional al ancho, máximo 2.2rem */
      margin-bottom: 10px;
      color: #ffffff;
      -webkit-text-stroke: 1.2px #000000 !important;
    }
    
    .logo {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 70px;
      opacity: 0.9;
    }
    .descripcion-lista {
      margin: 12px 0;
      padding-left: 0;
      list-style: none;
    }
    .descripcion-lista li {
      margin-bottom: 6px;
      padding-left: 28px;
      position: relative;
      font-size: 0.8rem;
      color: #ffffff;
      text-shadow: 0px 0px 6px rgba(0,0,0,0.6);
    }
    .descripcion-lista li::before {
      content: "✔"; /* Podés usar "➤", "★", "✓", "•", etc */
      position: absolute;
      left: 0;
      top: 0;
      color: #1bc324;
      font-size: 0.8rem;
      font-weight: bold;
      text-shadow: 0px 0px 4px rgba(0,0,0,0.7);
    }
    .cuotas-numero { font-size: 1.5rem; font-weight: 800; color: #ff6200b6; }
    .cuotas-texto { font-size: 1.2rem; font-weight: 400; color: #ff6200b6; }
    .cuotas-precio { font-size: 2rem; font-weight: 900; color: #ff6200; }
    .texto-lista-tachado { font-size: 1.5rem; color: #ffffff77; text-decoration: line-through; }
    .texto-contado { font-size: 1.5rem; font-weight: 800; color: #ff00007c; }
    .texto-precio-contado { font-size: 2rem; font-weight: 900; color: #ff0000; }
    .tarjetas { margin-top: 10px; }
    .tarjetas img { width: 150px; height: auto; display: block; margin-top: 8px; }


    .product-placeholder {
      flex: 1;
      max-width: 45%;
      max-height: 100%;
      border-radius: 12px;
      background: #f0f0f000; /* 🔹 gris claro, podés poner transparente */
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #aaaaaa00;
      font-style: italic;
    }

    .preview .download-btn {
  position: absolute;
  bottom: 15px;
  right: 15px;
  background: #ff6200;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  transition: background 0.3s;
}
.preview .download-btn:hover {
  background: #e05500;
}
.hide-during-capture {
  display: none !important;
}
.preview img.uploaded-product {
  flex: 1;
  max-width: 45%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 12px;
  align-self: center;
}
.uploaded-product {
  flex: 1;
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  border-radius: 12px;
  align-self: center;
  transform: scale(1); /* 🔹 escala inicial */
  transition: transform 0.2s ease; /* animación suave */
}

.preview {
  --font-scale: 1; /* Valor inicial */
}
.info h2 {
  font-size: calc(2rem * var(--font-scale));
  margin-bottom: 10px;
  color: #ffffff;
  -webkit-text-stroke: 1.2px #000000 !important;
}
.descripcion-lista li {
  margin-bottom: 6px;
  padding-left: 28px;
  position: relative;
  font-size: calc(0.8rem * var(--font-scale));
  color: #ffffff;
  text-shadow: 0px 0px 6px rgba(0,0,0,0.6);
}
.descripcion-lista li::before {
  content: "✔";
  position: absolute;
  left: 0;
  top: 0;
  color: #1bc324;
  font-size: calc(0.8rem * var(--font-scale));
  font-weight: bold;
  text-shadow: 0px 0px 4px rgba(0,0,0,0.7);
}
.cuotas-numero {
  font-size: calc(1.5rem * var(--font-scale));
  font-weight: 800;
  color: #ff6200b6;
}
.cuotas-texto {
  font-size: calc(1.2rem * var(--font-scale));
  font-weight: 400;
  color: #ff6200b6;
}
.cuotas-precio {
  font-size: calc(2rem * var(--font-scale));
  font-weight: 900;
  color: #ff6200;
}
.texto-lista-tachado {
  font-size: calc(1.5rem * var(--font-scale));
  color: #ffffff77;
  text-decoration: line-through;
}
.texto-contado {
  font-size: calc(1.5rem * var(--font-scale));
  font-weight: 800;
  color: #ff00007c;
}
.texto-precio-contado {
  font-size: calc(2rem * var(--font-scale));
  font-weight: 900;
  color: #ff0000;
}


  </style>
</head>
<body>
  <h1>Generador de Banner para Carrusel</h1>
  <input type="text" id="codigo" placeholder="Ingresá código de producto">
  <button onclick="generarPreview()">Generar</button>

  <div class="tabs">
    <button class="tab-btn active" onclick="mostrarTab('preview-cuotas')">6 Cuotas sin interés</button>
    <button class="tab-btn" onclick="mostrarTab('preview-contado')">Precio contado</button>
    <button class="tab-btn" onclick="mostrarTab('preview-12cuotas')">12 Cuotas fijas</button>
  </div>

  <input type="file" id="upload-producto" accept="image/png, image/jpeg">
<label for="zoom-producto">Zoom:</label>
<input type="range" id="zoom-producto" min="0.5" max="4" step="0.05" value="1">

<label for="tamano-texto">Tamaño de texto:</label>
<input type="range" id="tamano-texto" min="0.8" max="1.5" step="0.05" value="1">



  <!-- PREVIEW CUOTAS -->
<div id="preview-cuotas" class="preview active">
  <div id="preview-img-cuotas" class="product-placeholder"></div>
  <div class="info">
    <h2 id="preview-nombre-cuotas"></h2>
    <div id="preview-descripcion-cuotas"></div>
    <p id="preview-precio-cuotas"></p>
  </div>
  <img src="images/logo_trans.png" alt="Logo" class="logo" crossorigin="anonymous">
<button class="download-btn" onclick="descargarImagen('preview-cuotas')">⬇ Descargar</button>
</div>


<!-- PREVIEW CONTADO -->
<div id="preview-contado" class="preview">
  <div id="preview-img-contado" class="product-placeholder"></div>
  <div class="info">
    <h2 id="preview-nombre-contado"></h2>
    <div id="preview-descripcion-contado"></div>
    <p id="preview-precio-contado"></p>
  </div>
  <img src="images/logo_trans.png" alt="Logo" class="logo" crossorigin="anonymous">
<button class="download-btn" onclick="descargarImagen('preview-contado')">⬇ Descargar</button>
</div>


<!-- PREVIEW 12 CUOTAS -->
<div id="preview-12cuotas" class="preview">
  <div id="preview-img-12cuotas" class="product-placeholder"></div>
  <div class="info">
    <h2 id="preview-nombre-12cuotas"></h2>
    <div id="preview-descripcion-12cuotas"></div>
    <p id="preview-precio-12cuotas"></p>
    <div class="tarjetas">
      <img src="images/Tarjetas_de_credito.jpg" alt="Tarjetas admitidas" crossorigin="anonymous">
    </div>
  </div>
  <img src="images/logo_trans.png" alt="Logo" class="logo" crossorigin="anonymous">
<button class="download-btn" onclick="descargarImagen('preview-12cuotas')">⬇ Descargar</button>
</div>

  
  
  <script>
    let productoActual = null;

    function formatearDescripcion(texto) {
      if (!texto) return '';
      const partes = texto.split(/<br\s*\/?>|;|\n/).map(p => p.trim()).filter(p => p);
      return `<ul class="descripcion-lista">` + partes.map(p => `<li>${p}</li>`).join('') + `</ul>`;
    }

    function generarPreview() {
      const codigo = document.getElementById("codigo").value.trim();
      const producto = productos.find(p => p.codigo === codigo);
      if (!producto) { alert("No se encontró el producto"); return; }

      const datos = precios[codigo] || { precio_tarjeta: 'No disponible' };
      const precioLista = datos.precio_tarjeta !== 'No disponible' ? parseFloat(datos.precio_tarjeta) : null;
      const cuotas6 = precioLista ? precioLista / 6 : null;
      const precioConDescuento = precioLista ? precioLista * 0.79 : null;
      const cuotas12 = precioLista ? (precioLista * 1.19) / 12 : null;

      productoActual = codigo;

      // --- cuotas ---
      //document.getElementById("preview-img-cuotas").src = producto.imagen;
      document.getElementById("preview-nombre-cuotas").textContent = producto.nombre;
      document.getElementById("preview-descripcion-cuotas").innerHTML = formatearDescripcion(producto.descripcion);
      document.getElementById("preview-precio-cuotas").innerHTML = cuotas6
        ? `<span class="cuotas-numero">6 cuotas</span> <span class="cuotas-texto">sin interés de</span><br>
           <span class="cuotas-precio">$${cuotas6.toLocaleString('es-AR', { minimumFractionDigits: 2 })}</span>`
        : 'Consultar financiación';

      // --- contado ---
      //document.getElementById("preview-img-contado").src = producto.imagen;
      document.getElementById("preview-nombre-contado").textContent = producto.nombre;
      document.getElementById("preview-descripcion-contado").innerHTML = formatearDescripcion(producto.descripcion);
      document.getElementById("preview-precio-contado").innerHTML = precioConDescuento
        ? `<span class="texto-lista-tachado"> Precio de lista  $${precioLista.toLocaleString('es-AR')}</span><br>
           <span class="texto-contado">Contado:</span>
           <span class="texto-precio-contado">$${precioConDescuento.toLocaleString('es-AR')}</span>`
        : 'Consultar precio contado';

      // --- 12 cuotas ---
      //document.getElementById("preview-img-12cuotas").src = producto.imagen;
      document.getElementById("preview-nombre-12cuotas").textContent = producto.nombre;
      document.getElementById("preview-descripcion-12cuotas").innerHTML = formatearDescripcion(producto.descripcion);
      document.getElementById("preview-precio-12cuotas").innerHTML = cuotas12
        ? `<span class="cuotas-numero">12 cuotas</span> <span class="cuotas-texto">fijas</span><br>
           <span class="cuotas-precio">$${cuotas12.toLocaleString('es-AR', { minimumFractionDigits: 2 })}</span>`
        : 'Consultar financiación';
    }

    // Cargar la imagen desde el dispositivo
document.getElementById("upload-producto").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(event) {
    document.querySelectorAll(".product-placeholder").forEach(placeholder => {
      placeholder.innerHTML = `<img src="${event.target.result}" class="uploaded-product producto-img">`;
    });
  };
  reader.readAsDataURL(file);
});

// Controlar zoom con slider
document.getElementById("zoom-producto").addEventListener("input", function() {
  document.querySelectorAll(".producto-img").forEach(img => {
    img.style.transform = `scale(${this.value})`;
  });
});

// Controlar zoom con rueda del mouse sobre el slider
document.getElementById("zoom-producto").addEventListener("wheel", function(e) {
  e.preventDefault(); // evita scroll en toda la página
  const step = 0.1; // velocidad del zoom
  let newValue = parseFloat(this.value) + (e.deltaY < 0 ? step : -step);

  // limitar entre min y max
  newValue = Math.min(parseFloat(this.max), Math.max(parseFloat(this.min), newValue));

  this.value = newValue;
  this.dispatchEvent(new Event("input")); // fuerza la actualización del zoom
});




    function mostrarTab(id) {
      document.querySelectorAll('.preview').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
    }

    function descargarImagen(id) {
  const banner = document.getElementById(id);
  const boton = banner.querySelector(".download-btn");

   // 🔹 Agregar clase para ocultar temporalmente
  if (boton) boton.classList.add("hide-during-capture");


  // Tomar el nombre del producto desde el banner activo
  const nombreProducto = banner.querySelector("h2")?.innerText || "producto";

  // Normalizar el nombre → reemplaza espacios, elimina acentos/símbolos
  const nombreLimpio = nombreProducto
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // saca acentos
    .replace(/[^a-zA-Z0-9\s]/g, "") // saca caracteres raros
    .trim()
    .replace(/\s+/g, "_"); // reemplaza espacios por guiones bajos

  html2canvas(banner, {
    useCORS: true,
    allowTaint: false,
    backgroundColor: "#ffffff",
    scale: 2 // ✅ mejor calidad
  }).then(canvas => {

    // 🔹 Restaurar botón
    if (boton) boton.classList.remove("hide-during-capture");


    canvas.toBlob(function(blob) {
      const link = document.createElement("a");
      link.download = `${nombreLimpio}.png`; // 🔹 nombre dinámico
      link.href = URL.createObjectURL(blob);
      link.click();
      URL.revokeObjectURL(link.href);
    }, "image/png", 0.95);
  }).catch(err => {
    console.error("❌ Error al generar imagen:", err);
    alert("Hubo un error al generar la imagen. Revisá la consola.");
  });
}
// Controlar tamaño de texto con slider
document.getElementById("tamano-texto").addEventListener("input", function() {
  document.querySelectorAll(".preview").forEach(preview => {
    preview.style.setProperty('--font-scale', this.value);
  });
});

// Controlar tamaño de texto con rueda del mouse sobre el slider
document.getElementById("tamano-texto").addEventListener("wheel", function(e) {
  e.preventDefault(); // Evita scroll en la página
  const step = 0.05; // Velocidad del ajuste
  let newValue = parseFloat(this.value) + (e.deltaY < 0 ? step : -step);

  // Limitar entre min y max
  newValue = Math.min(parseFloat(this.max), Math.max(parseFloat(this.min), newValue));

  this.value = newValue;
  this.dispatchEvent(new Event("input")); // Fuerza la actualización del tamaño
});

  </script>
</body>
</html>
