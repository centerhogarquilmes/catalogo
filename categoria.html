<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categoría - Center Hogar Quilmes</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="images/logo.webp" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/logo_trans.png" alt="Center Hogar Quilmes" class="logo-img">
                    </a>
                </div>
                <div class="header-actions">
                    <button class="menu-toggle" aria-label="Abrir menú de navegación">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="header-contact">
                    <div class="contact-item">
                        <p><a href="https://api.whatsapp.com/send?phone=5491131680489&text=Hola,%20tengo%20una%20consulta" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="contact-icon">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                            11 3168-0489
                        </a></p>
                </div>
                <div class="contact-item">
                    <p><a href="https://maps.app.goo.gl/MGt4KohJ75XAGDWn8" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="contact-icon">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        Rivadavia 220
                        </a></p>
                </div>
                
        </div>
    </div>
    
            <div class="search-bar">
                <div class="search-bar-input-container">
                    <input type="text" placeholder="Buscar productos..." id="searchInput" autocomplete="off">
                    <button class="search-btn">
                        <img src="images/lupa.png" alt="Buscar" class="search-icon">
                    </button>
                </div>
                <div class="suggestions" id="suggestions" style="display: none;"></div>
            </div>
            <nav class="nav-menu" id="nav-menu">
    <ul>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Cocinas, anafes y purificadores">Cocina, anafes y purificadores</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Cocinas, anafes y purificadores&subcategoria=Cocinas">Cocinas</a></li>
                <li><a href="categoria.html?nombre=Cocinas, anafes y purificadores&subcategoria=Anafes">Anafes</a></li>
                <li><a href="categoria.html?nombre=Cocinas, anafes y purificadores&subcategoria=Purificadores">Purificadores</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Heladeras y freezers">Heladeras y freezers</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Heladeras y freezers&subcategoria=Heladeras">Heladeras</a></li>
                <li><a href="categoria.html?nombre=Heladeras y freezers&subcategoria=Freezers">Freezers</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Tv y audio">Tv y Audio</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Tv y audio&subcategoria=Tv">Tv</a></li>
                <li><a href="categoria.html?nombre=Tv y audio&subcategoria=Audio">Audio</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Tecnologia">Tecnología</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Celulares">Celulares</a></li>
                <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Tablets">Tablets</a></li>
                <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Notebooks">Notebooks</a></li>
                <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Impresoras">Impresoras</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Climatizacion">Climatización</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Calefaccion electrica">Calefacción eléctrica</a></li>
                <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Calefaccion a gas">Calefacción a gas</a></li>
                <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Ventilacion">Ventilación</a></li>
                <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Aires acondicionados">Aires Acondicionados</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Hornos, microondas y freidoras">Hornos, Microondas<br>y freidoras</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Hornos">Hornos</a></li>
                <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Microondas">Microondas</a></li>
                <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Freidoras">Freidoras</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Lavado">Lavado</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Lavado&subcategoria=Lavarropas">Lavarropas</a></li>
                <li><a href="categoria.html?nombre=Lavado&subcategoria=Lavasecarropas">Lavasecarropas</a></li>
                <li><a href="categoria.html?nombre=Lavado&subcategoria=Secarropas">Secarropas</a></li>
                <li><a href="categoria.html?nombre=Lavado&subcategoria=Planchas">Planchas</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Termotanques y calefones">Termotanques<br>y calefones</a>
            <ul class="submenu">
                
                <li><a href="categoria.html?nombre=Termotanques y calefones&subcategoria=Termotanques">Termotanques</a></li>
                <li><a href="categoria.html?nombre=Termotanques y calefones&subcategoria=Calefones">Calefones</a></li>
            </ul>
        </li><li class="has-submenu">
            <a href="categoria.html?nombre=Pequeños">Pequeños<br>electrodomésticos</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=batidoras">batidoras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Licuadoras">Licuadoras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Multiprocesadoras">Multiprocesadoras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Mixers">Mixers</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=pavas electricas">pavas electricas</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Cafeteras">Cafeteras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Tostadoras">Tostadoras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Sandwicheras">Sandwicheras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Exprimidores y Jugueras">Exprimidores y Jugueras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Picadoras">Picadoras</a></li>
                <li><a href="categoria.html?nombre=Pequeños&subcategoria=Aspiradoras">Aspiradoras</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=Cuidado personal">Cuidado Personal</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Planchas de pelo">Planchas de Pelo</a></li>
                <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Secadores de pelo">Secadores de Pelo</a></li>
                <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Cortadoras de pelo y barba">Cortadoras de Pelo y Barba</a></li>
            </ul>
        </li>
        <li class="has-submenu">
            <a href="categoria.html?nombre=hogar jardin y tiempo libre">hogar jardin y tiempo libre</a>
            <ul class="submenu">
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Colchones">Colchones</a></li>
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Sommiers">Sommiers</a></li>
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Almohadas">Almohadas</a></li>
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Jardín">Jardín</a></li>
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Bicicletas">Bicicletas</a></li>
                <li><a href="categoria.html?nombre=hogar jardin y tiempo libre&subcategoria=Piletas">Piletas</a></li>
            </ul>
        </li>
    </ul>
</nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <section class="catalog">
            <div class="search-container">
                <div class="filter-panel">
                    <button class="filter-toggle" aria-label="Abrir filtros">Filtros ☰</button>
                        <div class="filters" id="filters">
                            <h3>Filtros</h3>
                                <!-- Filtro de marca -->
                                <div class="filter-group collapsible-filter">
                                    <h4 class="collapsible-header">Marca</h4>
                                        <div class="collapsible-content">
                                        <!-- Opciones de marcas generadas dinámicamente -->
                                        </div>
                                </div>
                                <!-- Filtro de ordenamiento por precio -->
                                <div class="filter-group collapsible-filter">
                                    <h4 class="collapsible-header">Ordenar por precio</h4>
                                        <div class="collapsible-content">
                                            <label class="filter-option">
                                                <input type="radio" name="filter-orden-precio" value="menor-a-mayor" class="filter-radio"> Menor a Mayor
                                            </label>
                                            <label class="filter-option">
                                                <input type="radio" name="filter-orden-precio" value="mayor-a-menor" class="filter-radio"> Mayor a Menor
                                            </label>
                                        </div>
                                </div>
                                <!-- Filtros dinámicos -->
                                <div id="dynamic-filters">
                                <!-- Filtros dinámicos se generan aquí -->
                                </div>
                                <div class="filter-buttons">
                                    <button class="clear-filters buy-btn">Limpiar</button>
                                </div>
                        </div>
                    </div>
                <div class="results">
                    <h2 id="category-title">Productos</h2>
                        <div class="view-toggle" id="view-toggle">
                            <button class="view-btn grid-view active" data-view="grid" title="Vista en mosaico" aria-label="Vista en mosaico">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="view-btn list-view" data-view="list" title="Vista en lista" aria-label="Vista en lista">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="3" y1="6" x2="21" y2="6"></line>
                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                    <line x1="3" y1="18" x2="21" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                    <div class="active-filters" id="active-filters">
                        <!-- Filtros activos se muestran aquí -->
                    </div>
                    <div class="product-grid" id="product-grid">
                        <!-- Productos se llenan con JavaScript -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
    <div class="container">
        <p>© 2025 Center Hogar Quilmes. Todos los derechos reservados.</p>
        <ul>
            <li><a href="terminos.html">Términos y condiciones</a></li>
            <li><a href="contacto.html">Contacto</a></li>
            <li><a href="privacidad.html">Privacidad</a></li>
            <li><a href="garantia.html">Políticas de garantías</a></li>
        </ul>
    </div>
    </footer>

    <!-- Botón flotante para filtros -->
<button class="filter-float" title="Abrir filtros" aria-label="Abrir filtros">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" y1="6" x2="20" y2="6"></line>
        <line x1="4" y1="12" x2="20" y2="12"></line>
        <line x1="4" y1="18" x2="20" y2="18"></line>
        <circle cx="8" cy="6" r="1"></circle>
        <circle cx="8" cy="12" r="1"></circle>
        <circle cx="8" cy="18" r="1"></circle>
    </svg>
</button>

    <!-- Botón flotante para volver arriba -->
    <button class="scroll-to-top" title="Volver arriba">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19V5"></path>
            <path d="M5 12l7-7 7 7"></path>
        </svg>
    </button>

    <!-- Scripts -->
<script src="precios.js"></script>
<script src="productos.js"></script>
<script src="scripts.js"></script>
<script>
// Definir atributos filtrables por categoría
const atributosPorCategoria = {
    "lavado": [
        "Tipo de lavado",
        "Capacidad (kg)",
        "Inverter",
        "Velocidad de centrifugado (RPM)",
        "Tipo de carga"
    ],
    "tv y audio": [
        "Pulgadas",
        "Tipo de resolución",
        "Dimensiones",
        "Tipo de pantalla",
        "Sistema operativo"
    ],
    "tecnologia": [
        "Sistema operativo",
        "Almacenamiento",
        "Bateria",
        "NFC",
        "Cámara trasera",
        "Cámara frontal",
        "Red móvil",
        "RAM (GB)",
        "Almacenamiento (GB)",
        "Tipo de tinta",
        "WIFI",
        "Scanner",
        "Fotocopias",
        "Tipo de impresión",
        "Procesador",
        "Tamaño de pantalla (pulgadas)"
    ],
    "climatizacion": [
        "Potencia (W)",
        "Tiro balanceado",
        "Sin salida",
        "Dimensiones (Alt x Anc)",
        "Cantidad de velas",
        "Giratoria",
        "Potencia (Kcal)",
        "Tipo de gas",
        "Inverter",
        "Tipo",
        
    ],
    "cocinas, anafes y purificadores": [
        "Tipo",    
        "Tipo de uso",
        "Dimensiones",
        "Material",
        "Tipo de gas",
        "Encendido eléctrico",
        "Válvula de seguridad",
        "Luz en el horno",
        "Rejillas de fundición",
        "Hornallas",
        "Ladrillos refractarios"
        
    ],
    "heladeras y freezers": [
        "Dimensiones",
        "Capacidad (Litros)",
        "Tipo de tecnologia",
        "Inverter",
        "Dispenser de agua",
        "Tipo de heladera",
        "Eficiencia energética"
    ],
    "hornos, microondas y freidoras": [
        "Capacidad (Litros)",
        "Convector",
        "Anafes",
        "Spiedo",
        "Grill",
        "Potencia (W)",
        
    ],
    "termotanques y calefones": [
        "Tipo",
        "Dimensiones",
        "Capacidad (Litros)",
        "Conexiones",
        "Alta recuperación",
        "Colgar o apoyar",
        "Potencia",
        "Eficiencia energética"
    ],
    "pequenos": [
        "Capacidad (Litros)",
        "Potencia (W)",
        "Corte automático",
        "Capacidad (Litros)",
        "Tipo",
        "Velocidades",
        "Accesorios incluidos",
        "Cuchillas desmontables",
        "Ranuras",
        "Niveles de tostado",
        "Placas antiadherentes",
        "Funciones"
    ],
    "cuidado personal": [
        "Potencia (W)",
        "Temperatura máxima (°C)",
        "Velocidades",
        "Niveles de calor",
        "Apto pelo",
        "Apto barba",
        "Autonomía (min)",
        "Inalámbrica",
        
    ],

    "hogar jardin y tiempo libre": [
        "Plazas",
        "Dimensiones (Largo x Ancho x Alto)",
        "Resortes",
        "Espuma",
        "Pillow",
        "Estilo",
        "Material",
        "Materiales del relleno",
        "Inteligente",
        "Potencia (HP)",
        "Cilindrada",
        "Eléctrica",
        "Nafta",
        "Bolsa recolectora",
        "Rodado",
        "Tipo de frenos",
        "Canasto",
        "Portaequipaje",
        "Capacidad de agua (L)",
        "Forma",
        "Dimensiones (Cm)",
        "Inflable",
        "Escalera",
        
    ],
};


// Función para parsear el campo descripción y convertirlo en un objeto de atributos
function parsearDescripcion(descripcion) {
    const atributos = {};
    if (!descripcion) return atributos;

    const lineas = descripcion.split('\n');
    lineas.forEach(linea => {
        const match = linea.match(/<strong>([^:]+):<\/strong>\s*(.+)/);
        if (match) {
            const clave = match[1].trim();
            const valor = match[2].trim();
            atributos[clave] = valor;
        }
    });

    // Inferir "Smart TV" basado en "Sistema operativo"
    if (atributos["Sistema operativo"]) {
        const sistemasSmart = ["Android TV", "Google TV", "Titan OS", "Tyzen", "Vidaa", "GO"];
        atributos["Smart TV"] = sistemasSmart.includes(atributos["Sistema operativo"]) ? "Sí" : "No";
    }

    return atributos;
}

// Normalizar texto para manejar acentos y mayúsculas/minúsculas
function normalizeString(input) {
    if (Array.isArray(input)) {
        input = input.join(' ');
    }
    if (typeof input !== 'string') {
        input = String(input || '');
    }
    return input.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
}

// Obtener parámetros de la URL
const urlParams = new URLSearchParams(window.location.search);
const categoria = urlParams.get('nombre') || '';
const subcategoria = urlParams.get('subcategoria') || '';
console.log('URL Parameters - Categoria:', categoria, 'Subcategoria:', subcategoria);

// Obtener marcas únicas para la categoría y subcategoría seleccionadas
let marcas = [];
if (categoria) {
    let productosFiltrados = productos.filter(p => {
        const categoriaNormalizada = normalizeString(p.categoria);
        const categoriaBuscada = normalizeString(categoria);
        console.log('Comparando categoría:', categoriaNormalizada, 'con', categoriaBuscada);
        return categoriaNormalizada === categoriaBuscada;
    });
    if (subcategoria) {
        productosFiltrados = productosFiltrados.filter(p => {
            const subcategoriaNormalizada = normalizeString(p.subcategoria);
            const subcategoriaBuscada = normalizeString(subcategoria);
            console.log('Comparando subcategoría:', subcategoriaNormalizada, 'con', subcategoriaBuscada);
            return subcategoriaNormalizada === subcategoriaBuscada;
        });
    }
    marcas = [...new Set(
        productosFiltrados
            .map(p => p.caracteristicas.find(c => c.startsWith('Marca: '))?.replace('Marca: ', ''))
            .filter(m => m)
    )].sort((a, b) => a.localeCompare(b)); // Ordenar marcas alfabéticamente
}

// Poblar el filtro de marcas con checkboxes
const filterMarcaContainer = document.querySelector('.filter-group .collapsible-content');
marcas.forEach(marca => {
    const label = document.createElement('label');
    label.className = 'filter-option';
    label.innerHTML = `
        <input type="checkbox" name="filter-marca" value="${marca}" class="filter-checkbox"> ${marca}
    `;
    filterMarcaContainer.appendChild(label);
});

// Agregar evento para colapsar/desplegar el filtro de marca
const marcaHeader = document.querySelector('.filter-group .collapsible-header');
marcaHeader.addEventListener('click', () => {
    marcaHeader.classList.toggle('active');
    filterMarcaContainer.style.display = marcaHeader.classList.contains('active') ? 'block' : 'none';
});

// Agregar evento para colapsar/desplegar el filtro de orden por precio
const precioHeader = document.querySelectorAll('.collapsible-header')[1]; // Segundo header (orden por precio)
const precioContent = document.querySelectorAll('.collapsible-content')[1];
precioHeader.addEventListener('click', () => {
    precioHeader.classList.toggle('active');
    precioContent.style.display = precioHeader.classList.contains('active') ? 'block' : 'none';
});

// Generar filtros dinámicos según la categoría y subcategoría seleccionadas
function updateDynamicFilters(categoria, subcategoria) {
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    dynamicFiltersContainer.innerHTML = '';

    const categoriaNormalizada = normalizeString(categoria);
    const subcategoriaNormalizada = normalizeString(subcategoria);
    console.log('=== Inicio de updateDynamicFilters ===');
    console.log('Categoría:', categoria, '→ Normalizada:', categoriaNormalizada);
    console.log('Subcategoría:', subcategoria, '→ Normalizada:', subcategoriaNormalizada);

    let atributosFiltrables = [];
    if (categoriaNormalizada && atributosPorCategoria[categoriaNormalizada]) {
        console.log('Categoría encontrada en atributosPorCategoria:', categoriaNormalizada);
        if (subcategoriaNormalizada && typeof atributosPorCategoria[categoriaNormalizada] === 'object' && !Array.isArray(atributosPorCategoria[categoriaNormalizada])) {
            atributosFiltrables = atributosPorCategoria[categoriaNormalizada][subcategoriaNormalizada] || [];
            console.log('Atributos para subcategoría:', subcategoriaNormalizada, '→', atributosFiltrables);
        } else {
            atributosFiltrables = Array.isArray(atributosPorCategoria[categoriaNormalizada]) ? atributosPorCategoria[categoriaNormalizada] : [];
            console.log('Atributos para categoría (sin subcategoría):', atributosFiltrables);
        }
    } else {
        console.error('Categoría NO encontrada en atributosPorCategoria:', categoriaNormalizada);
        console.log('Claves disponibles en atributosPorCategoria:', Object.keys(atributosPorCategoria));
        return;
    }

    if (atributosFiltrables.length === 0) {
        console.warn('No se encontraron atributos filtrables para:', { categoriaNormalizada, subcategoriaNormalizada });
        return;
    }

    let productosFiltradosPorCategoria = productos.filter(p => {
        const catNorm = normalizeString(p.categoria);
        console.log('Producto:', p.nombre, 'Categoría:', p.categoria, '→ Normalizada:', catNorm);
        return catNorm === categoriaNormalizada;
    });
    console.log('Productos filtrados por categoría:', productosFiltradosPorCategoria.map(p => p.nombre));

    if (subcategoria) {
        productosFiltradosPorCategoria = productosFiltradosPorCategoria.filter(p => {
            const subcatNorm = normalizeString(p.subcategoria);
            console.log('Producto:', p.nombre, 'Subcategoría:', p.subcategoria, '→ Normalizada:', subcatNorm);
            return subcatNorm === subcategoriaNormalizada;
        });
        console.log('Productos filtrados por subcategoría:', productosFiltradosPorCategoria.map(p => p.nombre));
    }

    if (productosFiltradosPorCategoria.length === 0) {
        console.warn('No se encontraron productos para:', { categoriaNormalizada, subcategoriaNormalizada });
        return;
    }

    atributosFiltrables.forEach(atributo => {
        let valoresUnicos = [...new Set(
            productosFiltradosPorCategoria
                .map(p => {
                    const atributos = parsearDescripcion(p.descripcion);
                    console.log('Producto:', p.nombre, 'Atributos parseados:', atributos);
                    return atributos[atributo];
                })
                .filter(v => v && v !== '-' && v !== '0')
        )];
        console.log('Valores únicos para atributo', atributo, ':', valoresUnicos);

        if (valoresUnicos.length === 0) {
            console.log('No hay valores únicos para el atributo:', atributo);
            return;
        }

        // Ordenar valores numéricos para atributos específicos
        if (atributo === 'Capacidad (Litros)' || atributo === 'Capacidad' || atributo === 'Pulgadas' || atributo === 'Capacidad (kg)' || 
            atributo === 'Potencia' || atributo === 'Potencia (W)' || atributo === 'Velocidad de centrifugado (RPM)' || 
            atributo === 'Cámara trasera' || atributo === 'Cámara frontal' || atributo === 'Hornallas' || 
            atributo === 'Corte automático' || atributo === 'Tipo' || atributo === 'Colgar o apoyar' || 
            atributo === 'Presión (bar)' || atributo === 'Niveles de tostado') {
            valoresUnicos.sort((a, b) => {
                const numA = parseFloat(a.replace(/[^\d.]/g, '')) || 0;
                const numB = parseFloat(b.replace(/[^\d.]/g, '')) || 0;
                return numA - numB;
            });
        } else {
            valoresUnicos.sort((a, b) => a.localeCompare(b));
        }

        const filterGroup = document.createElement('div');
        filterGroup.className = 'filter-group collapsible-filter';

        const filterHeader = document.createElement('h4');
        filterHeader.textContent = atributo;
        filterHeader.className = 'collapsible-header';
        filterHeader.addEventListener('click', () => {
            filterHeader.classList.toggle('active');
            filterContent.style.display = filterHeader.classList.contains('active') ? 'block' : 'none';
        });

        const filterContent = document.createElement('div');
        filterContent.className = 'collapsible-content';
        filterContent.style.display = 'none';

        valoresUnicos.forEach(valor => {
            const label = document.createElement('label');
            label.className = 'filter-option';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = `filter-${normalizeString(atributo)}`;
            checkbox.value = valor;
            checkbox.className = 'filter-checkbox';
            checkbox.addEventListener('change', () => {
                console.log('Checkbox cambiado:', atributo, valor);
                filtrarProductos();
            });

            const span = document.createElement('span');
            span.textContent = valor;

            label.appendChild(checkbox);
            label.appendChild(span);
            filterContent.appendChild(label);
        });

        filterGroup.appendChild(filterHeader);
        filterGroup.appendChild(filterContent);
        dynamicFiltersContainer.appendChild(filterGroup);
        console.log('Filtro generado para atributo:', atributo);
    });
    console.log('=== Fin de updateDynamicFilters ===');
}

// Actualizar título de la categoría
let title = 'Productos';
if (subcategoria) {
    title = `Productos en ${subcategoria}`;
} else if (categoria) {
    title = `Productos en ${categoria}`;
}
document.getElementById('category-title').textContent = title;

// Función para mostrar los filtros activos
function mostrarFiltrosActivos() {
    const activeFiltersContainer = document.getElementById('active-filters');
    activeFiltersContainer.innerHTML = '';

    // Filtro de marca
    const marcaCheckboxes = document.querySelectorAll('input[name="filter-marca"]:checked');
    marcaCheckboxes.forEach(checkbox => {
        const valor = checkbox.value;
        const chip = document.createElement('div');
        chip.className = 'filter-chip';
        chip.innerHTML = `
            <span>Marca: ${valor}</span>
            <button data-filter="marca" data-valor="${valor}">×</button>
        `;
        activeFiltersContainer.appendChild(chip);
    });

    // Filtro de orden por precio
    const precioRadio = document.querySelector('input[name="filter-orden-precio"]:checked');
    if (precioRadio) {
        const valor = precioRadio.value === 'menor-a-mayor' ? 'Menor a Mayor' : 'Mayor a Menor';
        const chip = document.createElement('div');
        chip.className = 'filter-chip';
        chip.innerHTML = `
            <span>Orden: ${valor}</span>
            <button data-filter="orden-precio" data-valor="${precioRadio.value}">×</button>
        `;
        activeFiltersContainer.appendChild(chip);
    }

    // Filtros dinámicos
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    const filterGroups = dynamicFiltersContainer.querySelectorAll('.filter-group');
    filterGroups.forEach(group => {
        const atributo = group.querySelector('.collapsible-header').textContent;
        const checkboxes = group.querySelectorAll('.filter-checkbox:checked');
        checkboxes.forEach(checkbox => {
            const valor = checkbox.value;
            const chip = document.createElement('div');
            chip.className = 'filter-chip';
            chip.innerHTML = `
                <span>${atributo}: ${valor}</span>
                <button data-filter="dynamic" data-atributo="${atributo}" data-valor="${valor}">×</button>
            `;
            activeFiltersContainer.appendChild(chip);
        });
    });

    // Agregar evento para eliminar filtros
    activeFiltersContainer.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
            const filterType = button.dataset.filter;
            if (filterType === 'marca') {
                const valor = button.dataset.valor;
                const checkbox = document.querySelector(`input[name="filter-marca"][value="${valor}"]`);
                if (checkbox) {
                    checkbox.checked = false;
                }
            } else if (filterType === 'orden-precio') {
                const valor = button.dataset.valor;
                const radio = document.querySelector(`input[name="filter-orden-precio"][value="${valor}"]`);
                if (radio) {
                    radio.checked = false;
                }
            } else if (filterType === 'dynamic') {
                const atributo = button.dataset.atributo;
                const valor = button.dataset.valor;
                const checkbox = document.querySelector(`input[name="filter-${normalizeString(atributo)}"][value="${valor}"]`);
                if (checkbox) {
                    checkbox.checked = false;
                }
            }
            filtrarProductos();
        });
    });
}

// Configurar eventos para los checkboxes de marca y radios de precio
document.querySelectorAll('input[name="filter-marca"]').forEach(checkbox => {
    checkbox.addEventListener('change', filtrarProductos);
});
document.querySelectorAll('input[name="filter-orden-precio"]').forEach(radio => {
    radio.addEventListener('change', filtrarProductos);
});

// Limpiar filtros
document.querySelector('.clear-filters').addEventListener('click', () => {
    document.querySelectorAll('input[name="filter-marca"]:checked').forEach(checkbox => {
        checkbox.checked = false;
    });
    document.querySelectorAll('input[name="filter-orden-precio"]:checked').forEach(radio => {
        radio.checked = false;
    });
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    const checkboxes = dynamicFiltersContainer.querySelectorAll('.filter-checkbox:checked');
    checkboxes.forEach(checkbox => {
        checkbox.checked = false;
    });
    history.replaceState(null, '', `categoria.html?nombre=${encodeURIComponent(categoria)}${subcategoria ? `&subcategoria=${encodeURIComponent(subcategoria)}` : ''}`);
    filtrarProductos();
});

// Función para filtrar y ordenar productos
function filtrarProductos() {
    let productosFiltrados = productos;

    // Filtrar por categoría
    if (categoria) {
        productosFiltrados = productosFiltrados.filter(producto => normalizeString(producto.categoria) === normalizeString(categoria));
    }

    // Filtrar por subcategoría
    if (subcategoria) {
        productosFiltrados = productosFiltrados.filter(producto => normalizeString(producto.subcategoria) === normalizeString(subcategoria));
    }

    // Filtrar por marca
    const marcasSeleccionadas = Array.from(document.querySelectorAll('input[name="filter-marca"]:checked')).map(cb => cb.value);
    if (marcasSeleccionadas.length > 0) {
        productosFiltrados = productosFiltrados.filter(producto => 
            producto.caracteristicas.some(c => marcasSeleccionadas.includes(c.replace('Marca: ', '')))
        );
    }

    // Filtrar por atributos dinámicos
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    const filterGroups = dynamicFiltersContainer.querySelectorAll('.filter-group');
    filterGroups.forEach(group => {
        const checkboxes = group.querySelectorAll('.filter-checkbox:checked');
        if (checkboxes.length > 0) {
            const atributo = group.querySelector('.collapsible-header').textContent;
            const valoresSeleccionados = Array.from(checkboxes).map(checkbox => checkbox.value);
            productosFiltrados = productosFiltrados.filter(producto => {
                const atributos = parsearDescripcion(producto.descripcion);
                const valorAtributo = atributos[atributo];
                return valorAtributo && valoresSeleccionados.includes(valorAtributo);
            });
        }
    });

    // Ordenar por precio
    const ordenPrecio = document.querySelector('input[name="filter-orden-precio"]:checked');
    if (ordenPrecio) {
        productosFiltrados.sort((a, b) => {
            const precioA = precios && precios[a.codigo] && precios[a.codigo].precio_tarjeta !== 'No disponible' 
                ? parseFloat(precios[a.codigo].precio_tarjeta) 
                : Infinity;
            const precioB = precios && precios[b.codigo] && precios[b.codigo].precio_tarjeta !== 'No disponible' 
                ? parseFloat(precios[b.codigo].precio_tarjeta) 
                : Infinity;
            if (ordenPrecio.value === 'menor-a-mayor') {
                return precioA - precioB;
            } else {
                return precioB - precioA;
            }
        });
    }

    console.log(`Productos filtrados para categoría "${categoria}" y subcategoría "${subcategoria}":`, productosFiltrados.length);

    // Mostrar productos
    const productGrid = document.getElementById('product-grid');
    productGrid.innerHTML = '';
    if (productosFiltrados.length === 0) {
        productGrid.innerHTML = `
            <div class="no-results">
                <img src="images/nomedia_trans.png" alt="No se encontraron resultados">
                <p>No se han encontrado resultados</p>
            </div>
        `;
    } else {
        productosFiltrados.forEach(producto => {
            const datosDinamicos = precios && precios[producto.codigo] ? precios[producto.codigo] : { precio_tarjeta: 'No disponible', stock_sucursal: 0, stock_deposito: 0 };
            const precioLista = datosDinamicos.precio_tarjeta !== 'No disponible' ? parseFloat(datosDinamicos.precio_tarjeta) : null;
            const precioTextoLista = precioLista ? `$${precioLista.toLocaleString('es-AR')}` : 'Consultar precio';
            const precioAntesImpuestos = precioLista ? `$${(precioLista * 0.8265).toLocaleString('es-AR', { minimumFractionDigits: 2 })}` : 'Consultar precio';
            const isAgotado = datosDinamicos.stock_sucursal + datosDinamicos.stock_deposito === 0;

            const card = document.createElement('div');
            card.className = `product-card ${isAgotado ? 'agotado' : ''}`;
            card.innerHTML = `
                <a href="producto.html?nombre=${encodeURIComponent(producto.nombre)}&categoria=${encodeURIComponent(producto.categoria)}&subcategoria=${encodeURIComponent(producto.subcategoria || '')}&imagen=${encodeURIComponent(producto.imagen)}&imagenes=${producto.imagenes.map(img => encodeURIComponent(img)).join(',')}&descripcion=${encodeURIComponent(producto.descripcion)}&caracteristicas=${producto.caracteristicas.map(c => encodeURIComponent(c)).join(',')}">
                    ${isAgotado ? '<span class="agotado-label">Agotado</span>' : ''}
                    <img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.onerror=null; this.src='images/nomedia_trans.png';">
                    <div class="text-container">
                        <h3>${producto.nombre}</h3>
                        <p class="product-price">Precio de lista: ${precioTextoLista}</p>
                        <p class="product-price-before-tax">Pre. ant. imp. nac.: ${precioAntesImpuestos}</p>
                        <button class="buy-btn">Ver detalles</button>
                    </div>
                </a>
            `;
            productGrid.appendChild(card);
        });
    }

    // Actualizar URL con filtros
    const params = new URLSearchParams();
    if (categoria) params.set('nombre', categoria);
    if (subcategoria) params.set('subcategoria', subcategoria);
    if (marcasSeleccionadas.length > 0) params.set('marcas', marcasSeleccionadas.join(','));
    if (ordenPrecio) params.set('orden', ordenPrecio.value);
    history.replaceState(null, '', `categoria.html?${params.toString()}`);

    // Mostrar filtros activos
    mostrarFiltrosActivos();
}

// Inicializar filtros dinámicos
updateDynamicFilters(categoria, subcategoria);

// Ejecutar filtrado inicial
filtrarProductos();
</script>
</body>

</html>
