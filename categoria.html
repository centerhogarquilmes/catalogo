<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categor√≠a - Center Hogar Quilmes</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="images/logo.webp" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/logo_trans.png" alt="Center Hogar Quilmes" class="logo-img">
                    </a>
                </div>
                <div class="header-actions">
                    <div class="user-options">
                        <a href="presupuesto.html" class="user-link" title="Pedir presupuesto" aria-label="Pedir presupuesto">
                            <span class="icon">üìù</span>
                            <span class="label">Pedir presupuesto</span>
                        </a>
                        <a href="contacto.html" class="cart-link" title="Contacto" aria-label="Contacto">
                            <span class="icon">üì±</span>
                            <span class="label">Contacto</span>
                        </a>
                    </div>
                    <button class="menu-toggle" aria-label="Abrir men√∫ de navegaci√≥n">‚ò∞</button>
                </div>
            </div>
            <div class="search-bar">
                <div class="search-bar-input-container">
                    <input type="text" placeholder="Buscar productos..." id="searchInput" autocomplete="off">
                    <button class="search-btn">
                        <img src="images/lupa.png" alt="Buscar" class="search-icon">
                    </button>
                </div>
                <div class="suggestions" id="suggestions" style="display: none;"></div>
            </div>
            <nav class="nav-menu" id="nav-menu">
                <ul>
                    <li><a href="categoria.html?nombre=Cocinas">Cocinas</a></li>
                    <li><a href="categoria.html?nombre=Heladeras">Heladeras</a></li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Tv y audio">Tv y audio</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Tv y audio&subcategoria=Tv">Tv</a></li>
                            <li><a href="categoria.html?nombre=Tv y audio&subcategoria=Audio">Audio</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Tecnologia">Tecnolog√≠a</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Celulares">Celulares</a></li>
                            <li><a href="categoria.html?nombre=Tecnologia&subcategoria=Notebooks">Notebooks</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Climatizacion">Climatizaci√≥n</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Calefaccion">Calefacci√≥n</a></li>
                            <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Ventilacion">Ventilaci√≥n</a></li>
                            <li><a href="categoria.html?nombre=Climatizacion&subcategoria=Aires acondicionados">Aires Acondicionados</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Lavado">Lavado</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Lavado&subcategoria=Lavarropas">Lavarropas</a></li>
                            <li><a href="categoria.html?nombre=Lavado&subcategoria=Lavasecarropas">Lavasecarropas</a></li>
                            <li><a href="categoria.html?nombre=Lavado&subcategoria=Secarropas">Secarropas</a></li>
                            <li><a href="categoria.html?nombre=Lavado&subcategoria=Planchas">Planchas</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Hornos, microondas y freidoras">Hornos, Microondas y Freidoras</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Hornos">Hornos</a></li>
                            <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Microondas">Microondas</a></li>
                            <li><a href="categoria.html?nombre=Hornos, microondas y freidoras&subcategoria=Freidoras">Freidoras</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Peque√±os electrodomesticos">Peque√±os Electrodom√©sticos</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Batidoras">Batidoras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Licuadoras">Licuadoras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Multiprocesadoras">Multiprocesadoras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Mixers">Mixers</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Pavas electricas">Pavas El√©ctricas</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Cafeteras">Cafeteras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Tostadoras">Tostadoras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Sandwicheras">Sandwicheras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Exprimidores y jugueras">Exprimidores y Jugueras</a></li>
                            <li><a href="categoria.html?nombre=Peque√±os electrodomesticos&subcategoria=Picadoras">Picadoras</a></li>
                        </ul>
                    </li>
                    <li class="has-submenu">
                        <a href="categoria.html?nombre=Cuidado personal">Cuidado Personal</a>
                        <ul class="submenu">
                            <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Planchas de pelo">Planchas de Pelo</a></li>
                            <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Secadores de pelo">Secadores de Pelo</a></li>
                            <li><a href="categoria.html?nombre=Cuidado personal&subcategoria=Cortadoras de pelo y barba">Cortadoras de Pelo y Barba</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <section class="catalog">
            <div class="search-container">
                <div class="filter-panel">
                    <button class="filter-toggle" aria-label="Abrir filtros">Filtros ‚ò∞</button>
                    <div class="filters" id="filters">
                        <h3>Filtros</h3>
                        <div class="filter-group">
                            <h4>Marca</h4>
                            <select id="filter-marca">
                                <option value="">Todas</option>
                                <!-- Opciones generadas din√°micamente -->
                            </select>
                        </div>
                        <div id="dynamic-filters">
                            <!-- Filtros din√°micos se generan aqu√≠ -->
                        </div>
                        <div class="filter-buttons">
                            <button class="clear-filters buy-btn">Limpiar</button>
                        </div>
                    </div>
                </div>
                <div class="results">
                    <h2 id="category-title">Productos</h2>
                    <div class="active-filters" id="active-filters">
                        <!-- Filtros activos se muestran aqu√≠ -->
                    </div>
                    <div class="product-grid" id="product-grid">
                        <!-- Productos se llenan con JavaScript -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>¬© 2025 Center Hogar Quilmes. Todos los derechos reservados.</p>
            <ul>
                <li><a href="terminos.html">T√©rminos y condiciones</a></li>
                <li><a href="contacto.html">Contacto</a></li>
                <li><a href="privacidad.html">Privacidad</a></li>
            </ul>
        </div>
    </footer>

    <!-- Bot√≥n flotante para filtros -->
<button class="filter-float" title="Abrir filtros" aria-label="Abrir filtros">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="4" y1="6" x2="20" y2="6"></line>
        <line x1="4" y1="12" x2="20" y2="12"></line>
        <line x1="4" y1="18" x2="20" y2="18"></line>
        <circle cx="8" cy="6" r="1"></circle>
        <circle cx="8" cy="12" r="1"></circle>
        <circle cx="8" cy="18" r="1"></circle>
    </svg>
</button>

    <!-- Bot√≥n flotante para volver arriba -->
    <button class="scroll-to-top" title="Volver arriba">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19V5"></path>
            <path d="M5 12l7-7 7 7"></path>
        </svg>
    </button>

    <!-- Scripts -->
    <script src="productos.js"></script>
    <script src="scripts.js"></script>
    <script>
        // Definir atributos filtrables por categor√≠a
        
        const atributosPorCategoria = {
            "lavado": [
                "Tipo de lavado",
                "Capacidad (kg)",
                "Inverter",
                "Velocidad de centrifugado (RPM)",
                "Tipo de carga"
            ],
            "tv y audio": [
                "Pulgadas",
                "Tipo de resoluci√≥n",
                "Dimensiones",
                "Tipo de pantalla",
                "Sistema operativo"
            ],
            "tecnologia": [
                "Sistema operativo",
                "Almacenamiento",
                "Bateria",
                "NFC",
                "C√°mara trasera",
                "C√°mara frontal",
                "Red m√≥vil",
                "RAM (GB)"
            ],
            "climatizacion": [
                "Tipo de equipo",
                "Capacidad de enfriamiento",
                "Eficiencia energ√©tica"
            ],
            "cocinas": [
                "Tipo de uso",
                "Dimensiones",
                "Material",
                "Tipo de gas",
                "Encendido el√©ctrico",
                "V√°lvula de seguridad",
                "Luz en el horno",
                "Hornallas"
            ],
            "heladeras": [
                "Dimensiones",    
                "Capacidad",
                "Tipo de tecnologia",
                "Dispenser de agua",
                "Tipo de heladera",
                "Eficiencia energ√©tica"
            ],
            "hornos, microondas y freidoras": [
                "Tipo de equipo",
                "Capacidad (litros)",
                "Potencia (W)"
            ],
            "peque√±os electrodomesticos": [
                "Tipo de equipo",
                "Capacidad (Litros)",
                "Potencia (W)",
                "Apagado automatico",
                "Capacidad (litros)"
            ],
            "cuidado personal": [
                "Tipo de equipo",
                "Uso recomendado",
                "Potencia (W)"
            ]
        };

        // Funci√≥n para parsear el campo descripci√≥n y convertirlo en un objeto de atributos
        function parsearDescripcion(descripcion) {
            const atributos = {};
            if (!descripcion) return atributos;

            const lineas = descripcion.split('\n');
            lineas.forEach(linea => {
                const match = linea.match(/<strong>([^:]+):<\/strong>\s*(.+)/);
                if (match) {
                    const clave = match[1].trim();
                    const valor = match[2].trim();
                    atributos[clave] = valor;
                }
            });

            // Inferir "Smart TV" basado en "Sistema operativo"
            if (atributos["Sistema operativo"]) {
                const sistemasSmart = ["Android TV", "Google TV", "Titan OS", "Tyzen", "Vidaa", "GO"];
                atributos["Smart TV"] = sistemasSmart.includes(atributos["Sistema operativo"]) ? "S√≠" : "No";
            }

            return atributos;
        }

        // Normalizar texto para manejar acentos y may√∫sculas/min√∫sculas
        function normalizeString(input) {
            if (Array.isArray(input)) {
                input = input.join(' ');
            }
            if (typeof input !== 'string') {
                input = String(input || '');
            }
            return input.normalize('NFD').replace(/[\u0300-\u036f]/g, '').toLowerCase();
        }

        // Obtener par√°metros de la URL
        const urlParams = new URLSearchParams(window.location.search);
        const categoria = urlParams.get('nombre') || '';
        const subcategoria = urlParams.get('subcategoria') || '';

        // Obtener marcas √∫nicas para la categor√≠a seleccionada
        let marcas = [];
        if (categoria) {
            marcas = [...new Set(productos
                .filter(p => normalizeString(p.categoria) === normalizeString(categoria))
                .map(p => p.caracteristicas.find(c => c.startsWith('Marca: '))?.replace('Marca: ', ''))
                .filter(m => m))];
        }

        // Poblar el selector de marcas
        const filterMarca = document.getElementById('filter-marca');
        marcas.forEach(marca => {
            const option = document.createElement('option');
            option.value = marca;
            option.textContent = marca;
            filterMarca.appendChild(option);
        });

        // Generar filtros din√°micos seg√∫n la categor√≠a seleccionada
        function updateDynamicFilters(categoria) {
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    dynamicFiltersContainer.innerHTML = '';

    const categoriaNormalizada = normalizeString(categoria);
    if (!categoriaNormalizada || !atributosPorCategoria[categoriaNormalizada]) {
        return;
    }

    const atributosFiltrables = atributosPorCategoria[categoriaNormalizada];
    const productosFiltradosPorCategoria = productos.filter(p => normalizeString(p.categoria) === categoriaNormalizada);

    atributosFiltrables.forEach(atributo => {
        let valoresUnicos = [...new Set(
            productosFiltradosPorCategoria
                .map(p => {
                    const atributos = parsearDescripcion(p.descripcion);
                    return atributos[atributo];
                })
                .filter(v => v && v !== '-' && v !== '0')
        )];

        if (valoresUnicos.length === 0) return;

        // Ordenar valores num√©ricos para "Capacidad (litros)", "Capacidad" y "Pulgadas" de menor a mayor
        if (atributo === 'Capacidad (litros)' || atributo === 'Capacidad' || atributo === 'Sistema operativo'|| atributo === 'Pulgadas'|| atributo === 'Capacidad (kg)' || atributo === 'Hornallas' || atributo === 'Inverter' || atributo === 'Potencia (W)'|| atributo === 'C√°mara trasera' || atributo === 'C√°mara frontal' || atributo === 'Velocidad de centrifugado (RPM)'  || atributo === 'Dimensiones' )  {
            valoresUnicos.sort((a, b) => {
                // Extraer el n√∫mero (eliminando "Litros", "pulgadas" u otras unidades)
                const numA = parseFloat(a.replace(/[^\d.]/g, '')) || 0;
                const numB = parseFloat(b.replace(/[^\d.]/g, '')) || 0;
                return numA - numB;
            });
        }

        const filterGroup = document.createElement('div');
        filterGroup.className = 'filter-group collapsible-filter';

        const filterHeader = document.createElement('h4');
        filterHeader.textContent = atributo;
        filterHeader.className = 'collapsible-header';
        filterHeader.addEventListener('click', () => {
            filterHeader.classList.toggle('active');
            filterContent.style.display = filterHeader.classList.contains('active') ? 'block' : 'none';
        });

        const filterContent = document.createElement('div');
        filterContent.className = 'collapsible-content';
        filterContent.style.display = 'none';

        valoresUnicos.forEach(valor => {
            const label = document.createElement('label');
            label.className = 'filter-option';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.name = `filter-${normalizeString(atributo)}`;
            checkbox.value = valor;
            checkbox.className = 'filter-checkbox';
            checkbox.addEventListener('change', filtrarProductos);

            const span = document.createElement('span');
            span.textContent = valor;

            label.appendChild(checkbox);
            label.appendChild(span);
            filterContent.appendChild(label);
        });

        filterGroup.appendChild(filterHeader);
        filterGroup.appendChild(filterContent);
        dynamicFiltersContainer.appendChild(filterGroup);
    });
}

        // Actualizar t√≠tulo de la categor√≠a
        let title = 'Productos';
        if (subcategoria) {
            title = `Productos en ${subcategoria}`;
        } else if (categoria) {
            title = `Productos en ${categoria}`;
        }
        document.getElementById('category-title').textContent = title;

        // Funci√≥n para mostrar los filtros activos
function mostrarFiltrosActivos() {
    const activeFiltersContainer = document.getElementById('active-filters');
    activeFiltersContainer.innerHTML = '';

    // Marca
    if (filterMarca.value) {
        const chip = document.createElement('div');
        chip.className = 'filter-chip';
        chip.innerHTML = `
            <span>Marca: ${filterMarca.value}</span>
            <button data-filter="marca">√ó</button>
        `;
        activeFiltersContainer.appendChild(chip);
    }

    // Filtros din√°micos (solo checkboxes)
    const dynamicFiltersContainer = document.getElementById('dynamic-filters');
    const filterGroups = dynamicFiltersContainer.querySelectorAll('.filter-group');
    filterGroups.forEach(group => {
        const atributo = group.querySelector('.collapsible-header').textContent;
        const checkboxes = group.querySelectorAll('.filter-checkbox:checked');
        checkboxes.forEach(checkbox => {
            const valor = checkbox.value; // Correcci√≥n: asignar el valor del checkbox
            const chip = document.createElement('div');
            chip.className = 'filter-chip';
            chip.innerHTML = `
                <span>${atributo}: ${valor}</span>
                <button data-filter="dynamic" data-atributo="${atributo}" data-valor="${valor}">√ó</button>
            `;
            activeFiltersContainer.appendChild(chip);
        });
    });

    // Agregar evento para eliminar filtros
    activeFiltersContainer.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', () => {
            const filterType = button.dataset.filter;
            if (filterType === 'marca') {
                filterMarca.value = '';
            } else if (filterType === 'dynamic') {
                const atributo = button.dataset.atributo;
                const valor = button.dataset.valor;
                const checkbox = document.querySelector(`input[name="filter-${normalizeString(atributo)}"][value="${valor}"]`);
                if (checkbox) {
                    checkbox.checked = false;
                }
            }
            filtrarProductos();
        });
    });
}

        // Configurar eventos
        filterMarca.addEventListener('change', filtrarProductos);

        // Limpiar filtros
        document.querySelector('.clear-filters').addEventListener('click', () => {
            filterMarca.value = '';
            const dynamicFiltersContainer = document.getElementById('dynamic-filters');
            const checkboxes = dynamicFiltersContainer.querySelectorAll('.filter-checkbox:checked');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            history.replaceState(null, '', `categoria.html?nombre=${encodeURIComponent(categoria)}${subcategoria ? `&subcategoria=${encodeURIComponent(subcategoria)}` : ''}`);
            filtrarProductos();
        });

        // Funci√≥n para filtrar productos
        function filtrarProductos() {
            let productosFiltrados = productos;

            if (categoria) {
                productosFiltrados = productosFiltrados.filter(producto => normalizeString(producto.categoria) === normalizeString(categoria));
            }

            if (subcategoria) {
                productosFiltrados = productosFiltrados.filter(producto => normalizeString(producto.subcategoria) === normalizeString(subcategoria));
            }

            const marca = filterMarca.value;
            if (marca) {
                productosFiltrados = productosFiltrados.filter(producto => 
                    producto.caracteristicas.some(c => c === `Marca: ${marca}`)
                );
            }

            const dynamicFiltersContainer = document.getElementById('dynamic-filters');
            const filterGroups = dynamicFiltersContainer.querySelectorAll('.filter-group');
            filterGroups.forEach(group => {
                const checkboxes = group.querySelectorAll('.filter-checkbox:checked');
                if (checkboxes.length > 0) {
                    const atributo = group.querySelector('.collapsible-header').textContent;
                    const valoresSeleccionados = Array.from(checkboxes).map(checkbox => checkbox.value);
                    productosFiltrados = productosFiltrados.filter(producto => {
                        const atributos = parsearDescripcion(producto.descripcion);
                        const valorAtributo = atributos[atributo];
                        return valorAtributo && valoresSeleccionados.includes(valorAtributo);
                    });
                }
            });

            console.log(`Productos filtrados para categor√≠a "${categoria}" y subcategor√≠a "${subcategoria}":`, productosFiltrados.length);

            const productGrid = document.getElementById('product-grid');
            productGrid.innerHTML = '';
            if (productosFiltrados.length === 0) {
                productGrid.innerHTML = `
                    <div class="no-results">
                        <img src="images/nomedia_trans.png" alt="No se encontraron resultados">
                        <p>No se han encontrado resultados</p>
                    </div>
                `;
            } else {
                productosFiltrados.forEach(producto => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <a href="producto.html?nombre=${encodeURIComponent(producto.nombre)}&categoria=${encodeURIComponent(producto.categoria)}&subcategoria=${encodeURIComponent(producto.subcategoria || '')}&imagen=${encodeURIComponent(producto.imagen)}&imagenes=${producto.imagenes.map(img => encodeURIComponent(img)).join(',')}&descripcion=${encodeURIComponent(producto.descripcion)}&caracteristicas=${producto.caracteristicas.map(c => encodeURIComponent(c)).join(',')}">
                            <img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.onerror=null; this.src='images/nomedia_trans.png';">
                            <h3>${producto.nombre}</h3>
                            <p class="product-code">C√≥digo: ${producto.codigo}</p>
                            <button class="buy-btn">Ver m√°s</button>
                        </a>
                    `;
                    productGrid.appendChild(card);
                });
            }

            const params = new URLSearchParams();
            if (categoria) params.set('nombre', categoria);
            if (subcategoria) params.set('subcategoria', subcategoria);
            if (marca) params.set('marca', marca);
            history.replaceState(null, '', `categoria.html?${params.toString()}`);

            // Mostrar filtros activos
            mostrarFiltrosActivos();
        }

        // Inicializar filtros din√°micos
        updateDynamicFilters(categoria);

        // Ejecutar filtrado inicial
        filtrarProductos();
    </script>
</body>
</html>