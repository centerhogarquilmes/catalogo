<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#667eea">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Calculadora Center Hogar</title>
  <link rel="stylesheet" href="calculadora.css">
  <link rel="icon" href="images/logo.webp" type="image/x-icon">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <div class="calculadora">
    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="calculadora"><span>Calculadora</span></button>
      <button class="tab-btn" data-tab="promociones"><span>Promociones</span></button>
      <button class="tab-btn" data-tab="descuentos"><span>Descuentos</span></button>
    </div>

    <!-- TAB: CALCULADORA -->
    <div id="tab-calculadora" class="tab-content active">
      <input type="text" id="visor" readonly placeholder="0">

      <div class="fila">
        <button class="btn-ac" onclick="borrar()">AC</button>
        <button class="btn-func" onclick="calcularPorcentaje()">%</button>
        <button class="btn-func" onclick="abrirHistorial()">HISTORIAL</button>
        <button class="btn-ac" onclick="limpiarVisor()">C</button>
        <button class="btn-ac" onclick="borrarUltimo()">←</button>
      </div>

      <div class="fila">
        <button class="btn-cuota" onclick="calcularCuotas(3)">3 cuotas</button>
        <input id="interes3" class="interes" type="number" value="0">
        <span class="porc">%</span>
      </div>

      <div class="fila">
        <button class="btn-cuota" onclick="calcularCuotas(6)">6 cuotas</button>
        <input id="interes6" class="interes" type="number" value="0">
        <span class="porc">%</span>
      </div>

      <div class="fila">
        <button class="btn-cuota" onclick="calcularCuotas(9)">9 cuotas</button>
        <input id="interes9" class="interes" type="number" value="0">
        <span class="porc">%</span>
      </div>

      <div class="fila">
        <button class="btn-cuota" onclick="calcularCuotas(12)">12 cuotas</button>
        <input id="interes12" class="interes" type="number" value="5">
        <span class="porc">%</span>
      </div>

      <div class="fila">
        <button onclick="clickBoton('7')">7</button>
        <button onclick="clickBoton('8')">8</button>
        <button onclick="clickBoton('9')">9</button>
        <button class="btn-op" onclick="clickBoton('/')">÷</button>
      </div>

      <div class="fila">
        <button onclick="clickBoton('4')">4</button>
        <button onclick="clickBoton('5')">5</button>
        <button onclick="clickBoton('6')">6</button>
        <button class="btn-op" onclick="clickBoton('*')">×</button>
      </div>

      <div class="fila">
        <button onclick="clickBoton('1')">1</button>
        <button onclick="clickBoton('2')">2</button>
        <button onclick="clickBoton('3')">3</button>
        <button class="btn-op" onclick="clickBoton('-')">−</button>
      </div>

      <div class="fila">
        <button onclick="clickBoton('0')">0</button>
        <button onclick="clickBoton('000')">000</button>
        <button class="btn-op" onclick="clickBoton('+')">+</button>
        <button class="btn-op" onclick="operaciones()">=</button>
      </div>

      <div class="fila">
        <button class="btn-guardar" onclick="guardarValorManual()">GUARDAR</button>
        <button class="btn-guardar" onclick="volverValorManual()">VOLVER</button>
      </div>
    </div>

    <!-- TAB: PROMOCIONES -->
    <div id="tab-promociones" class="tab-content">
      <h2>Control de Promociones</h2>
      <input type="text" id="codigoProducto" placeholder="Ingrese el código">
      <button class="btn-verificar" onclick="verificarPromocion()">Verificar</button>
      <p id="mensajePromocion"></p>
    </div>

    <!-- TAB: DESCUENTOS (AHORA DENTRO) -->
    <div id="tab-descuentos" class="tab-content">
      <div class="contenedor-descuentos">
        <div class="seccion">
          <h3>Calcular % de Descuento</h3>
          <label>Precio de Lista:</label>
          <input type="number" id="precioLista" step="0.01" placeholder="0.00">
          <label>Precio con Descuento:</label>
          <input type="number" id="precioDescuento" step="0.01" placeholder="0.00">
          <button class="btn-calcular" onclick="calcularDescuento()">Calcular</button>
          <h4 id="resultado">—</h4>
          <button class="btn-copiar" onclick="copiarResultado()">Copiar %</button>
        </div>

        <div class="seccion">
          <h3>Pago Mixto (15% off en contado)</h3>
          <label>Pago en Contado:</label>
          <input type="number" id="contado" step="0.01" placeholder="0.00">
          <button class="btn-calcular" onclick="calcularPagoMixto()">Calcular</button>
          <div class="resultados-mixtos">
            <p>Total con 15% off: <span id="totalContado">-</span></p>
            <p>Resto con descuento: <span id="restoContado">-</span></p>
            <p>Resto a lista: <span id="restoLista">-</span></p>
            <p><strong>Precio Final:</strong> <span id="precioFinal">-</span></p>
            <p><strong>Descuento Total:</strong> <span id="descuento">0%</span></p>
          </div>
          <button class="btn-copiar" onclick="copiarResultados()">Copiar %</button>
        </div>

        <div class="seccion">
          <h3>Desde Lista + Contado</h3>
          <label>Parte a Lista:</label>
          <input type="number" id="parteLista" step="0.01" placeholder="0.00">
          <button class="btn-calcular" onclick="calcularDesdeLista()">Calcular</button>
          <div class="resultados-mixtos">
            <p>Base con 15% off: <span id="totalContado2">-</span></p>
            <p>Parte con descuento: <span id="parteContado">-</span></p>
            <p><strong>Precio Final:</strong> <span id="precioFinal2">-</span></p>
            <p><strong>Descuento Total:</strong> <span id="descuento2">0%</span></p>
          </div>
          <button class="btn-copiar" onclick="copiarDescuento()">Copiar %</button>
        </div>
      </div>
    </div>
  </div> <!-- CIERRE CORRECTO DE .calculadora -->

  <!-- MODAL HISTORIAL (FUERA, BIEN) -->
  <div id="modalHistorial" class="modal">
    <div class="modal-content">
      <span class="cerrar" onclick="cerrarHistorial()">×</span>
      <h2>Historial de Operaciones</h2>
      <ul id="listaHistorial"></ul>
    </div>
  </div>

  <script src="productos.js"></script>
  <script src="calculadora.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log('SW registrado:', reg))
          .catch(err => console.log('Error SW:', err));
      });
    }
  </script>
</body>
</html>